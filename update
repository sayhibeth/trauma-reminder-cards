<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Trauma Reminder Cards</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body {
    font-family: Arial, Helvetica, sans-serif;
    background:#f5f5f5;
    display:flex; flex-direction:column; align-items:center; padding:20px;
  }
  h1 { margin-bottom:30px; }

  .cards {
    display:flex; flex-wrap:wrap; justify-content:center;
    gap:40px 60px;
    max-width:1200px; width:100%;
  }
  .card {
    width:240px; height:160px; /* bigger cards */
    perspective:1000px; cursor:pointer; position:relative;
    transition: transform .3s ease, box-shadow .3s ease;
  }
  .card:hover:not(.answeredCard) {
    transform: translateY(-6px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  .inner {
    position:relative; width:100%; height:100%;
    transition:transform .6s ease; transform-style:preserve-3d;
  }
  .flipped .inner { transform:rotateY(180deg); }
  
  .front, .back {
    position:absolute; width:100%; height:100%; backface-visibility:hidden;
    border-radius:12px; box-shadow:0 6px 12px rgba(0,0,0,0.2);
    display:flex; align-items:center; justify-content:center;
    overflow:hidden;
  }
  .back { 
    background-image: url("https://static.wixstatic.com/media/b668a8_b474fb9b05d7447ca0bc2378826bd56b~mv2.png");
    background-size: cover;
    background-position: center;
  }
  .front {
    background:white; color:#222;
    transform:rotateY(180deg);
  }
  .frontLabel {
    position:absolute; bottom:8px; left:8px; right:8px;
    font-size:20px; font-weight:bold;
    background: rgba(255,255,255,0.8);
    padding:4px;
    border-radius:4px;
    text-align:center;
  }

  .activeCard { 
    box-shadow:0 0 15px 4px #FFD600 !important; 
    border-radius:12px; 
  }
  .card.answeredCard { 
    opacity: 0.5;             /* darker */
    filter: grayscale(80%);   /* more muted */
    transition: opacity .3s ease, filter .3s ease;
  }
  .card.answeredCard::after {
    content: "✔"; 
    position: absolute; 
    top: 6px; 
    right: 10px;
    font-size: 22px; 
    font-weight: bold; 
    color: #28a745; 
    text-shadow: 0 0 6px white, 0 0 3px white; /* stronger glow */
  }

  .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5);
    display:flex; align-items:center; justify-content:center; z-index:50; }
  .overlayContent { position: relative; display:flex; flex-direction:column; align-items:center; width:100%; max-width:700px; }
  .overlay .card { width:500px; height:320px; /* larger overlay card */
    box-shadow:0 12px 24px rgba(0,0,0,.5); margin-bottom:20px; border-radius:12px; overflow:hidden; }

  .closeBtn {
    position:absolute; top:-10px; right:-10px; background:#fff;
    border:2px solid #444; border-radius:50%; width:30px; height:30px;
    display:flex; align-items:center; justify-content:center; font-weight:bold;
    cursor:pointer; box-shadow:0 2px 6px rgba(0,0,0,.3);
  }
  .closeBtn:hover { background:#FFD600; }

  .bubble {
    display:inline-flex; flex-direction:column; align-items:center; justify-content:center;
    text-align:center; background:white; border-radius:14px;
    box-shadow:0 6px 20px rgba(0,0,0,.3); padding:14px 18px;
    max-width:520px; width:auto;
  }
  .bubble p { margin:0 0 8px; font-size:16px; font-weight:bold; }
  .bubble textarea {
    width:400px; height:70px; margin-bottom:8px; font-size:16px; padding:8px;
    border-radius:6px; border:2px solid #bbb; resize:none;
  }
  .bubble textarea.flat {
    height:28px; /* one-line "Why" box */
  }
  .bubble button {
    background:#FFD600; color:#000; border:none; border-radius:20px;
    padding:6px 14px; font-size:14px; font-weight:bold; cursor:pointer;
  }
  .bubble button:hover { background:#FFC400; transform:scale(1.05); }

  #finishBtn { margin-top:40px; padding:14px 28px; font-size:18px;
    background:#222; color:white; border:none; border-radius:8px; cursor:pointer; }
</style>
</head>
<body>

<h1>Trauma Reminder Cards</h1>
<div class="cards" id="cardContainer"></div>
<button id="finishBtn">Finish & Download PDF</button>

<script>
const { jsPDF } = window.jspdf;

const cardData = [
  { category: "Card 1", frontImage: "https://static.wixstatic.com/media/b668a8_8ca1e0d3d11b49acaa2e4cba9876005b~mv2.png", prompt: "List some noises or sounds that remind you of the trauma." },
  { category: "Card 2", frontImage: "https://static.wixstatic.com/media/b668a8_4d535fe994824f9eb39ce3ca24709b48~mv2.png", prompt: "List some smells that remind you of the trauma" },
  { category: "Card 3", frontImage: "https://static.wixstatic.com/media/b668a8_4897f6ccb8d54f3ebfa30b4d1ea8cb49~mv2.png", prompt: "List some things you see that remind you of the trauma" },
  { category: "Card 4", frontImage: "https://static.wixstatic.com/media/b668a8_8ccdd3eed937498bbb84ce1e791cd97f~mv2.png", prompt: "List some thinks you feel with your hands or body that remind you of the trauma." },
  { category: "Card 5", frontImage: "https://static.wixstatic.com/media/b668a8_8004623ff2bc4322838c426d0d0903da~mv2.png", prompt: "List some feelings that you experience that remind you of the trauma?" },
  { category: "Card 6", frontImage: "https://static.wixstatic.com/media/b668a8_c2857813302246a592d15b9398ae3d1e~mv2.png", prompt: "List some tastes or flavors that remind you of the trauma" },
  { category: "Card 7", frontImage: "https://static.wixstatic.com/media/b668a8_c2857813302246a592d15b9398ae3d1e~mv2.png", prompt: "List some changes that have happened because of the trauma?" }
];

const container = document.getElementById("cardContainer");

cardData.forEach((c, i) => {
  const hidden = document.createElement("textarea"); hidden.style.display = "none"; hidden.setAttribute("data-idx", i); document.body.appendChild(hidden);
  const hiddenWhy = document.createElement("textarea"); hiddenWhy.style.display = "none"; hiddenWhy.setAttribute("data-why-idx", i); document.body.appendChild(hiddenWhy);

  const cardEl = document.createElement("div");
  cardEl.className = "card";
  cardEl.innerHTML = `
    <div class="inner">
      <div class="back"></div>
      <div class="front">
        <img src="${c.frontImage}" alt="${c.category}" style="width:100%; height:100%; object-fit:cover;">
        <div class="frontLabel">${c.category}</div>
      </div>
    </div>
  `;
  cardEl.addEventListener("click", () => openOverlay(cardEl, c, i));
  container.appendChild(cardEl);
});

function openOverlay(cardEl, card, idx) {
  cardEl.classList.add("activeCard");
  const overlay = document.createElement("div");
  overlay.className = "overlay";
  overlay.innerHTML = `
    <div class="overlayContent">
      <div class="closeBtn">✕</div>
      <div class="card">
        <img src="${card.frontImage}" alt="${card.category}" style="width:100%; height:100%; object-fit:cover;">
      </div>
      <div class="bubble">
        <p>${card.prompt}</p>
        <textarea data-idx="${idx}"></textarea>
        <p>Why is it a reminder?</p>
        <textarea class="flat" data-why-idx="${idx}"></textarea>
        <button class="enterBtn">Enter</button>
      </div>
    </div>
  `;
  document.body.appendChild(overlay);

  const textarea = overlay.querySelector('textarea[data-idx="'+idx+'"]');
  const textareaWhy = overlay.querySelector('textarea[data-why-idx="'+idx+'"]');
  const original = document.querySelector('textarea[data-idx="'+idx+'"]');
  const originalWhy = document.querySelector('textarea[data-why-idx="'+idx+'"]');

  textarea.value = original.value;
  textareaWhy.value = originalWhy.value;

  overlay.querySelector(".enterBtn").addEventListener("click", () => {
    original.value = textarea.value;
    originalWhy.value = textareaWhy.value;
    overlay.remove();
    cardEl.classList.remove("activeCard");
    if (textarea.value.trim() !== "" || textareaWhy.value.trim() !== "") {
      cardEl.classList.add("answeredCard");
    } else {
      cardEl.classList.remove("answeredCard");
    }
  });
  overlay.querySelector(".closeBtn").addEventListener("click", () => {
    overlay.remove();
    cardEl.classList.remove("activeCard");
  });
}

document.getElementById("finishBtn").addEventListener("click", () => {
  if (!window.confirm("Are you sure you want to finish and download the PDF?")) return;

  const doc = new jsPDF();
  let y = 20;
  cardData.forEach((c, idx) => {
    const ans = document.querySelector('textarea[data-idx="'+idx+'"]').value;
    const whyAns = document.querySelector('textarea[data-why-idx="'+idx+'"]').value;

    doc.setFontSize(18); doc.setFont("helvetica", "bold");
    doc.text(c.category, 20, y); y+=12;

    doc.setFontSize(16); doc.setFont("helvetica", "normal");
    doc.text("Answer: " + (ans || "(no answer)"), 30, y, {maxWidth:160}); y+=10;

    doc.setFont("helvetica", "italic");
    doc.text("Why: " + (whyAns || "(no answer)"), 40, y, {maxWidth:150});
    doc.setFont("helvetica", "normal");
    y+=28;

    if (y > 270) { doc.addPage(); y = 20; }
  });
  doc.save("card_game_answers.pdf");
});
</script>
</body>
</html>
